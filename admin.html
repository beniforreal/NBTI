<!doctype html>
<html lang="ko" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ê´€ë¦¬ì í˜ì´ì§€</title>
  <meta name="color-scheme" content="dark light">
  <style>
    :root{
      --bg:#141a1f; --panel:#1c242b; --panel-2:#202a33; --text:#dfe7ef; --muted:#93a1ad; --accent:#7dd3fc; --ok:#9ae6b4; --warn:#f6ad55; --danger:#feb2b2; --radius:14px;
    }
    html,body{margin:0;background:var(--bg);color:var(--text);font:14px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Pretendard,Helvetica,Arial;}
    a{color:var(--accent);text-decoration:none}
    .wrap{max-width:600px;margin:50px auto;padding:0 18px}
    .login-card{background:var(--panel);border:1px solid #2a3640;border-radius:var(--radius);padding:40px;text-align:center}
    .login-title{font-size:28px;font-weight:700;margin:0 0 20px;color:var(--accent)}
    .login-subtitle{color:var(--muted);margin:0 0 30px;font-size:16px}
    .form-group{margin:20px 0}
    .form-label{display:block;margin-bottom:8px;font-weight:600;color:var(--text)}
    .form-input{width:100%;padding:12px 16px;background:#0f1418;color:var(--text);border:1px solid #2a3640;border-radius:10px;font-size:16px;box-sizing:border-box}
    .form-input:focus{outline:none;border-color:var(--accent)}
    .btn{background:var(--accent);color:#000;border:none;padding:12px 24px;border-radius:10px;cursor:pointer;font-size:16px;font-weight:600;width:100%;margin:20px 0}
    .btn:hover{filter:brightness(1.1)}
    .btn-secondary{background:var(--panel-2);color:var(--text);border:1px solid #2b3843}
    .btn-secondary:hover{filter:brightness(1.1)}
    .error{color:var(--danger);margin:10px 0;font-size:14px}
    .success{color:var(--ok);margin:10px 0;font-size:14px}
    .admin-links{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-top:30px}
    .admin-link{background:var(--panel-2);border:1px solid #2a3640;border-radius:10px;padding:20px;text-align:center;text-decoration:none;color:var(--text);transition:all 0.2s}
    .admin-link:hover{background:var(--panel);border-color:var(--accent)}
    .admin-link h3{margin:0 0 8px;color:var(--accent)}
    .admin-link p{margin:0;color:var(--muted);font-size:13px}
    .logout-btn{position:absolute;top:20px;right:20px;background:var(--danger);color:white;border:none;padding:8px 16px;border-radius:6px;cursor:pointer;font-size:12px}
    .logout-btn:hover{filter:brightness(1.1)}
    
    /* ì‚­ì œ í™•ì¸ ëª¨ë‹¬ */
    .delete-modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);z-index:2000;display:none;align-items:center;justify-content:center;padding:20px}
    .delete-content{background:var(--panel);border-radius:16px;max-width:400px;width:100%;border:1px solid #2a3640;padding:0}
    .delete-header{padding:20px 24px;border-bottom:1px solid #2a3640;text-align:center}
    .delete-title{font-size:20px;font-weight:700;margin:0;color:var(--danger)}
    .delete-body{padding:24px;text-align:center}
    .delete-message{color:var(--text);margin:0 0 20px;line-height:1.5}
    .delete-actions{display:flex;gap:12px;justify-content:center}
    .delete-actions .btn{min-width:100px}
    .btn-danger{background:var(--danger);color:white}
    .btn-danger:hover{filter:brightness(1.1)}
    .btn-cancel{background:var(--panel-2);color:var(--text);border:1px solid #2b3843}
    .btn-cancel:hover{filter:brightness(1.1)}
    
    /* ë°˜ì‘í˜• */
    @media (max-width: 768px) {
      .wrap{padding:0 12px;margin:30px auto}
      .login-card{padding:30px 20px}
      .login-title{font-size:24px}
      .admin-links{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div id="loginSection" class="login-card">
      <h1 class="login-title">ğŸ” ê´€ë¦¬ì ë¡œê·¸ì¸</h1>
      <p class="login-subtitle">NBTI ê¸¸ë“œ ì‚¬ì§„ì²© ê´€ë¦¬ì í˜ì´ì§€</p>
      
      <form id="loginForm">
        <div class="form-group">
          <label class="form-label" for="password">ë¹„ë°€ë²ˆí˜¸</label>
          <input type="password" id="password" class="form-input" placeholder="ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required>
        </div>
        <button type="submit" class="btn">ë¡œê·¸ì¸</button>
        <div id="errorMsg" class="error" style="display:none"></div>
      </form>
    </div>

    <div id="adminSection" class="login-card" style="display:none">
      <button id="logoutBtn" class="logout-btn">ë¡œê·¸ì•„ì›ƒ</button>
      <h1 class="login-title">ğŸ‘‘ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h1>
      <p class="login-subtitle">ì‚¬ì§„ì²© ê´€ë¦¬ ë„êµ¬</p>
      
      <div class="admin-links">
        <a href="./index.html" class="admin-link">
          <h3>ğŸ“· ì‚¬ì§„ì²© ê´€ë¦¬</h3>
          <p>ì‚¬ì§„ ì—…ë¡œë“œ, ìˆ˜ì •, ì‚­ì œ</p>
        </a>
        <a href="./guild.html" class="admin-link">
          <h3>ğŸ‘¥ ê¸¸ë“œì› ê´€ë¦¬</h3>
          <p>ê¸¸ë“œì› ì¶”ê°€, ì‚­ì œ, ì—…ë¡œë“œ</p>
        </a>
      </div>
      
      <div style="margin-top:30px;padding:20px;background:#0f1418;border-radius:10px;border:1px solid #2a3640">
        <h3 style="margin:0 0 15px;color:var(--accent)">ğŸ“Š í˜„ì¬ ìƒíƒœ</h3>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;font-size:13px">
          <div>ì‚¬ì§„ ê°œìˆ˜: <span id="photoCount" style="color:var(--ok)">0</span></div>
          <div>ê¸¸ë“œì› ìˆ˜: <span id="memberCount" style="color:var(--ok)">0</span></div>
        </div>
      </div>
    </div>
  </div>

  <!-- ì‚­ì œ í™•ì¸ ëª¨ë‹¬ -->
  <div id="deleteModal" class="delete-modal">
    <div class="delete-content">
      <div class="delete-header">
        <h2 class="delete-title">âš ï¸ ì‚­ì œ í™•ì¸</h2>
      </div>
      <div class="delete-body">
        <p id="deleteMessage" class="delete-message">ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
        <div class="delete-actions">
          <button id="deleteCancel" class="btn btn-cancel">ì·¨ì†Œ</button>
          <button id="deleteConfirm" class="btn btn-danger">ì‚­ì œ</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ë³´ì•ˆ ê°•í™”ëœ ê´€ë¦¬ì ì¸ì¦ ì‹œìŠ¤í…œ
    const ADMIN_KEY = "admin.authenticated";
    const ADMIN_SESSION_KEY = "admin.session";
    const SESSION_TIMEOUT = 2 * 60 * 60 * 1000; // 2ì‹œê°„
    const IP_LOCK_KEY = "admin.ip_locks";
    const MAX_ATTEMPTS = 3;
    const LOCK_DURATION = 24 * 60 * 60 * 1000; // 24ì‹œê°„
    
    // í•´ì‹œ í•¨ìˆ˜ (ê°„ë‹¨í•œ í•´ì‹œ)
    function simpleHash(str) {
      let hash = 0;
      for (let i = 0; i < str.length; i++) {
        const char = str.charCodeAt(i);
        hash = ((hash << 5) - hash) + char;
        hash = hash & hash; // 32bit ì •ìˆ˜ë¡œ ë³€í™˜
      }
      return Math.abs(hash).toString(16);
    }
    
    // ë¹„ë°€ë²ˆí˜¸ í•´ì‹œê°’ (ì‹¤ì œ ë¹„ë°€ë²ˆí˜¸: nbti2024)
    const ADMIN_PASSWORD_HASH = "514ac857"; // simpleHash("nbti2024")ì˜ ê²°ê³¼ê°’
    
    // í´ë¼ì´ì–¸íŠ¸ IP ì¶”ì¶œ (ê°„ë‹¨í•œ ë°©ë²•)
    function getClientIP() {
      // ì‹¤ì œ IPëŠ” ì„œë²„ì—ì„œë§Œ ì–»ì„ ìˆ˜ ìˆì§€ë§Œ, í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œì—ì„œëŠ” 
      // User-Agent + ì‹œê°„ëŒ€ + í™”ë©´ í•´ìƒë„ ë“±ì„ ì¡°í•©í•˜ì—¬ ê³ ìœ  ì‹ë³„ì ìƒì„±
      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');
      ctx.textBaseline = 'top';
      ctx.font = '14px Arial';
      ctx.fillText('IP fingerprint', 2, 2);
      
      const fingerprint = [
        navigator.userAgent,
        navigator.language,
        screen.width + 'x' + screen.height,
        new Date().getTimezoneOffset(),
        canvas.toDataURL()
      ].join('|');
      
      return simpleHash(fingerprint);
    }
    
    // IP ë½ ê´€ë¦¬
    function getIPLocks() {
      try {
        return JSON.parse(localStorage.getItem(IP_LOCK_KEY) || '{}');
      } catch (e) {
        return {};
      }
    }
    
    function saveIPLocks(locks) {
      localStorage.setItem(IP_LOCK_KEY, JSON.stringify(locks));
    }
    
    function isIPLocked() {
      const clientIP = getClientIP();
      const locks = getIPLocks();
      const lockData = locks[clientIP];
      
      if (!lockData) return false;
      
      const now = Date.now();
      if (now - lockData.timestamp > LOCK_DURATION) {
        // ë½ ë§Œë£Œ
        delete locks[clientIP];
        saveIPLocks(locks);
        return false;
      }
      
      return true;
    }
    
    function addIPAttempt() {
      const clientIP = getClientIP();
      const locks = getIPLocks();
      
      if (!locks[clientIP]) {
        locks[clientIP] = { attempts: 0, timestamp: Date.now() };
      }
      
      locks[clientIP].attempts++;
      locks[clientIP].timestamp = Date.now();
      
      if (locks[clientIP].attempts >= MAX_ATTEMPTS) {
        locks[clientIP].locked = true;
        locks[clientIP].lockTime = Date.now();
      }
      
      saveIPLocks(locks);
      return locks[clientIP].attempts;
    }
    
    function clearIPAttempts() {
      const clientIP = getClientIP();
      const locks = getIPLocks();
      delete locks[clientIP];
      saveIPLocks(locks);
    }
    
    const loginSection = document.getElementById('loginSection');
    const adminSection = document.getElementById('adminSection');
    const loginForm = document.getElementById('loginForm');
    const passwordInput = document.getElementById('password');
    const errorMsg = document.getElementById('errorMsg');
    const logoutBtn = document.getElementById('logoutBtn');
    const photoCount = document.getElementById('photoCount');
    const memberCount = document.getElementById('memberCount');
    
    // ì‚­ì œ ëª¨ë‹¬ ìš”ì†Œë“¤
    const deleteModal = document.getElementById('deleteModal');
    const deleteMessage = document.getElementById('deleteMessage');
    const deleteCancel = document.getElementById('deleteCancel');
    const deleteConfirm = document.getElementById('deleteConfirm');

    // ì„¸ì…˜ ìœ íš¨ì„± ê²€ì‚¬
    function isSessionValid() {
      const sessionData = localStorage.getItem(ADMIN_SESSION_KEY);
      if (!sessionData) return false;
      
      try {
        const session = JSON.parse(sessionData);
        const now = Date.now();
        return (now - session.timestamp) < SESSION_TIMEOUT;
      } catch (e) {
        return false;
      }
    }
    
    // ê´€ë¦¬ì ì¸ì¦ í™•ì¸
    function checkAdminAuth() {
      // IP ë½ í™•ì¸
      if (isIPLocked()) {
        showLockedMessage();
        return;
      }
      
      const isAuthenticated = localStorage.getItem(ADMIN_KEY) === 'true';
      const sessionValid = isSessionValid();
      
      if (isAuthenticated && sessionValid) {
        showAdminSection();
      } else {
        // ì„¸ì…˜ ë§Œë£Œ ì‹œ ìë™ ë¡œê·¸ì•„ì›ƒ
        if (isAuthenticated && !sessionValid) {
          logout();
        }
        showLoginSection();
      }
    }

    // ë½ ë©”ì‹œì§€ í‘œì‹œ
    function showLockedMessage() {
      loginSection.innerHTML = `
        <h1 class="login-title">ğŸš« ì ‘ê·¼ ì°¨ë‹¨</h1>
        <p class="login-subtitle">ë„ˆë¬´ ë§ì€ ë¡œê·¸ì¸ ì‹œë„ë¡œ ì¸í•´ ì ‘ê·¼ì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
        <div style="margin:20px 0;padding:20px;background:#2a1010;border:1px solid #5a1c1c;border-radius:10px">
          <p style="color:var(--danger);margin:0;font-size:14px">
            ì´ ê¸°ê¸°ì—ì„œ 3ë²ˆì˜ ë¡œê·¸ì¸ ì‹¤íŒ¨ë¡œ ì¸í•´ 24ì‹œê°„ ë™ì•ˆ ì ‘ê·¼ì´ ì œí•œë©ë‹ˆë‹¤.<br>
            ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ê±°ë‚˜ 24ì‹œê°„ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.
          </p>
        </div>
        <div style="margin-top:20px;font-size:12px;color:var(--muted)">
          <p>ì°¨ë‹¨ëœ ê¸°ê¸° ì •ë³´:</p>
          <p style="font-family:monospace;word-break:break-all">${getClientIP()}</p>
        </div>
      `;
      adminSection.style.display = 'none';
    }

    // ë¡œê·¸ì¸ ì„¹ì…˜ í‘œì‹œ
    function showLoginSection() {
      loginSection.innerHTML = `
        <h1 class="login-title">ğŸ” ê´€ë¦¬ì ë¡œê·¸ì¸</h1>
        <p class="login-subtitle">NBTI ê¸¸ë“œ ì‚¬ì§„ì²© ê´€ë¦¬ì í˜ì´ì§€</p>
        
        <form id="loginForm">
          <div class="form-group">
            <label class="form-label" for="password">ë¹„ë°€ë²ˆí˜¸</label>
            <input type="password" id="password" class="form-input" placeholder="ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required>
          </div>
          <button type="submit" class="btn">ë¡œê·¸ì¸</button>
          <div id="errorMsg" class="error" style="display:none"></div>
        </form>
      `;
      
      // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¬ë“±ë¡
      const newForm = document.getElementById('loginForm');
      const newPasswordInput = document.getElementById('password');
      const newErrorMsg = document.getElementById('errorMsg');
      
      newForm.addEventListener('submit', handleLogin);
      
      adminSection.style.display = 'none';
    }

    // ê´€ë¦¬ì ì„¹ì…˜ í‘œì‹œ
    function showAdminSection() {
      loginSection.style.display = 'none';
      adminSection.style.display = 'block';
      updateStats();
    }

    // í†µê³„ ì—…ë°ì´íŠ¸
    function updateStats() {
      try {
        const photos = JSON.parse(localStorage.getItem('album.items.v1') || '[]');
        const members = JSON.parse(localStorage.getItem('guild.members.v1') || '[]');
        photoCount.textContent = photos.length;
        memberCount.textContent = members.length;
      } catch (e) {
        photoCount.textContent = '0';
        memberCount.textContent = '0';
      }
    }

    // ë¡œê·¸ì¸ ì²˜ë¦¬ í•¨ìˆ˜
    function handleLogin(e) {
      e.preventDefault();
      const passwordInput = document.getElementById('password');
      const errorMsg = document.getElementById('errorMsg');
      const password = passwordInput.value.trim();
      const passwordHash = simpleHash(password);
      
      if (passwordHash === ADMIN_PASSWORD_HASH) {
        // ì¸ì¦ ì„±ê³µ
        localStorage.setItem(ADMIN_KEY, 'true');
        clearIPAttempts(); // ì„±ê³µ ì‹œ ì‹œë„ íšŸìˆ˜ ì´ˆê¸°í™”
        
        // ì„¸ì…˜ ì •ë³´ ì €ì¥
        const sessionData = {
          timestamp: Date.now(),
          userAgent: navigator.userAgent,
          ip: getClientIP()
        };
        localStorage.setItem(ADMIN_SESSION_KEY, JSON.stringify(sessionData));
        
        showAdminSection();
      } else {
        // ì‹¤íŒ¨ ì‹œ IP ê¸°ë°˜ ë½ ì²˜ë¦¬
        const attempts = addIPAttempt();
        const remainingAttempts = MAX_ATTEMPTS - attempts;
        
        if (attempts >= MAX_ATTEMPTS) {
          showLockedMessage();
        } else {
          errorMsg.textContent = `ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤. (${remainingAttempts}íšŒ ë‚¨ìŒ)`;
          errorMsg.style.display = 'block';
          passwordInput.value = '';
        }
      }
    }

    // ë¡œê·¸ì•„ì›ƒ í•¨ìˆ˜
    function logout() {
      localStorage.removeItem(ADMIN_KEY);
      localStorage.removeItem(ADMIN_SESSION_KEY);
      localStorage.removeItem('login_attempts');
    }
    
    // ê´€ë¦¬ììš© ë½ í•´ì œ í•¨ìˆ˜ (ê°œë°œì ë„êµ¬ì—ì„œ ì‚¬ìš©)
    function unlockAllIPs() {
      localStorage.removeItem(IP_LOCK_KEY);
      console.log('ëª¨ë“  IP ë½ì´ í•´ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
    }
    
    // íŠ¹ì • IP ë½ í•´ì œ í•¨ìˆ˜
    function unlockIP(ipHash) {
      const locks = getIPLocks();
      delete locks[ipHash];
      saveIPLocks(locks);
      console.log(`IP ${ipHash}ì˜ ë½ì´ í•´ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
    }
    
    // í˜„ì¬ ë½ëœ IP ëª©ë¡ í™•ì¸
    function getLockedIPs() {
      const locks = getIPLocks();
      const lockedIPs = [];
      for (const [ip, data] of Object.entries(locks)) {
        if (data.locked) {
          lockedIPs.push({
            ip: ip,
            attempts: data.attempts,
            lockTime: new Date(data.lockTime).toLocaleString(),
            remainingTime: Math.max(0, LOCK_DURATION - (Date.now() - data.lockTime))
          });
        }
      }
      console.table(lockedIPs);
      return lockedIPs;
    }
    
    // ì‚­ì œ í™•ì¸ ëª¨ë‹¬ í•¨ìˆ˜ë“¤
    let currentDeleteCallback = null;
    
    function showDeleteModal(message, callback) {
      deleteMessage.textContent = message;
      currentDeleteCallback = callback;
      deleteModal.style.display = 'flex';
    }
    
    function hideDeleteModal() {
      deleteModal.style.display = 'none';
      currentDeleteCallback = null;
    }
    
    // ì‚­ì œ ëª¨ë‹¬ ì´ë²¤íŠ¸
    deleteCancel.addEventListener('click', hideDeleteModal);
    deleteConfirm.addEventListener('click', () => {
      if (currentDeleteCallback) {
        currentDeleteCallback();
      }
      hideDeleteModal();
    });
    
    // ëª¨ë‹¬ ë°°ê²½ í´ë¦­ìœ¼ë¡œ ë‹«ê¸°
    deleteModal.addEventListener('click', (e) => {
      if (e.target === deleteModal) {
        hideDeleteModal();
      }
    });
    
    // ESC í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸°
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && deleteModal.style.display === 'flex') {
        hideDeleteModal();
      }
    });
    
    // ì „ì—­ í•¨ìˆ˜ë¡œ ë…¸ì¶œ (ê°œë°œì ë„êµ¬ì—ì„œ ì‚¬ìš© ê°€ëŠ¥)
    window.unlockAllIPs = unlockAllIPs;
    window.unlockIP = unlockIP;
    window.getLockedIPs = getLockedIPs;
    window.showDeleteModal = showDeleteModal;
    
    // ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼
    logoutBtn.addEventListener('click', () => {
      logout();
      showLoginSection();
    });

    // ì´ˆê¸° ë¡œë“œ
    checkAdminAuth();
    
    // ê°œë°œì ë„êµ¬ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë„ì›€ë§
    console.log(`
ğŸ” NBTI ê´€ë¦¬ì ì‹œìŠ¤í…œ ë„ì›€ë§:

ğŸ“‹ ë½ ê´€ë¦¬ ëª…ë ¹ì–´:
- getLockedIPs() : í˜„ì¬ ë½ëœ IP ëª©ë¡ í™•ì¸
- unlockAllIPs() : ëª¨ë“  IP ë½ í•´ì œ
- unlockIP('IPí•´ì‹œ') : íŠ¹ì • IP ë½ í•´ì œ

ğŸ—‘ï¸ ì‚­ì œ ê´€ë¦¬ ëª…ë ¹ì–´:
- showDeleteModal('ë©”ì‹œì§€', callback) : ì‚­ì œ í™•ì¸ ëª¨ë‹¬ í‘œì‹œ

ğŸ’¡ ì‚¬ìš© ì˜ˆì‹œ:
- getLockedIPs() // ë½ëœ IP ëª©ë¡ ë³´ê¸°
- unlockAllIPs() // ëª¨ë“  ë½ í•´ì œ
- unlockIP('abc123') // íŠ¹ì • IP ë½ í•´ì œ
- showDeleteModal('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?', () => console.log('ì‚­ì œë¨'))

âš ï¸ ì£¼ì˜: ì´ ëª…ë ¹ì–´ë“¤ì€ ê´€ë¦¬ìë§Œ ì‚¬ìš©í•˜ì„¸ìš”.
    `);
  </script>
</body>
</html>
